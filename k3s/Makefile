NAMESPACE=internal

.PHONY: all apply clean status logs

all: apply status

apply:
	@echo "ðŸš€ Applying Kubernetes namespace..."
	kubectl apply -f namespaces.yaml
	@echo "âœ… Namespace applied!"

	@echo "ðŸš€ Applying ConfigMaps and Secrets..."
	kubectl apply -f configs/
	@echo "âœ… Configs and Secrets applied!"

	@echo "ðŸš€ Deploying StatefulSets (Databases)..."
	kubectl apply -f statefulsets/
	@echo "âœ… StatefulSets deployed!"

	@echo "ðŸš€ Deploying Microservices..."
	kubectl apply -f deployments/
	@echo "âœ… Deployments applied!"

	@echo "ðŸš€ Creating Services..."
	kubectl apply -f services/
	@echo "âœ… Services applied!"

	@echo "ðŸš€ Applying Ingress..."
	kubectl apply -f ingress.yaml
	@echo "âœ… Ingress applied!"

	@echo "ðŸŽ‰ Deployment complete!"

clean:
	@echo "ðŸ”¥ Deleting all Kubernetes resources..."
	kubectl delete namespace $(NAMESPACE)
	@echo "âœ… Namespace and all resources deleted!"

status:
	@echo "ðŸ“Œ Checking pod status..."
	kubectl get pods -n $(NAMESPACE)
	@echo "ðŸ“Œ Checking services..."
	kubectl get services -n $(NAMESPACE)
	@echo "ðŸ“Œ Checking ingress..."
	kubectl get ingress -n $(NAMESPACE)

logs:
	@echo "ðŸ“œ Fetching logs for all pods..."
	kubectl logs -l app=auth-service -n $(NAMESPACE) --tail=100
	kubectl logs -l app=patient-service -n $(NAMESPACE) --tail=100
	kubectl logs -l app=api-gateway -n $(NAMESPACE) --tail=100
	kubectl logs -l app=billing-service -n $(NAMESPACE) --tail=100
	kubectl logs -l app=analytics-service -n $(NAMESPACE) --tail=100
	kubectl logs -l app=kafka -n $(NAMESPACE) --tail=100
